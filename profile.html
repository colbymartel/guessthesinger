<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile | GuessTheSinger.com</title>
  <link rel="icon" href="/favicon.ico" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./signup.css" />
  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      background: #f5f6fa;
      padding: 0;
      margin: 0;
    }
    .profile-container {
      max-width: 420px;
      margin: 40px auto;
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .profile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .avatar-grid {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 10px;
}

.avatar-img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 2px solid transparent;
  cursor: pointer;
  object-fit: cover;
}

    .avatar-display {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .avatar-display img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
    }
    .edit-icon {
      cursor: pointer;
      color: #28a7ae;
    }
    .status-section, .dashboard-section, .socials-section {
      margin-top: 30px;
    }
    .status-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .status-tag {
      background: #e6f9f9;
      color: #28a7ae;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
    }
    .btn {
      width: 100%;
      padding: 12px;
      background: #28a7ae;
      border: none;
      color: #fff;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }
    .btn:hover {
      background: #23949b;
    }
    .modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
  flex-direction: column;
}

.modal.show {
  display: flex !important; 
}


    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      width: 90%;
    }
    .input-group {
      margin-bottom: 15px;
    }

    .input-group select {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  font-family: 'Fredoka', sans-serif;
  border: 2px solid #ccc;
  border-radius: 12px;
  background-color: #f9f9f9;
  color: #333;
  appearance: none; /* Removes native arrow in some browsers */
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D'12'%20height%3D'8'%20viewBox%3D'0%200%2012%208'%20xmlns%3D'http%3A//www.w3.org/2000/svg'%3E%3Cpath%20d%3D'M6%208L0%200h12L6%208z'%20fill%3D'%23666'%20/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 16px top 50%;
  background-size: 12px 8px;
  transition: border-color 0.3s, box-shadow 0.3s;
  margin-bottom: 15px;
}

.input-group select:focus {
  outline: none;
  border-color: #28a7ae;
  box-shadow: 0 0 6px rgba(40, 167, 174, 0.4);
}
    nav {
  background-color: #1e2b38;
  padding: 15px 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  color: white;
}

/* Welcome on the left */
.welcome-nav {
  position: absolute;
  left: 30px;
}

/* Hamburger on the right */
.hamburger {
  position: absolute;
  right: 30px;
  font-size: 24px;
  cursor: pointer;
  color: white;
}

/* Nav links centered */
.nav-links {
  display: flex;
  gap: 20px;
  align-items: center;
}

.nav-links a {
  color: white;
  text-decoration: none;
  font-weight: bold;
}

.nav-links a:hover {
  color: #ffcb05;
}
.edit-btn {
  background: none;
  border: none;
  color: #28a7ae;
  font-weight: bold;
  cursor: pointer;
}
.edit-btn:hover {
  text-decoration: underline;
}
.avatar-img.selected {
  border-color: #ffcb05; /* Yellow border */
  box-shadow: 0 0 8px rgba(255, 203, 5, 0.6); /* Optional glow */
}
.close {
  position: absolute;
  top: 12px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: #aaa;
}

.close:hover {
  color: #000;
}
.modal-content {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  position: relative;
}
#vibeSearch {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  font-family: 'Fredoka', sans-serif;
  border: 2px solid #ccc;
  border-radius: 12px;
  background-color: #f9f9f9;
  color: #333;
  margin-bottom: 15px;
  transition: border-color 0.3s, box-shadow 0.3s;
}

#vibeSearch:focus {
  outline: none;
  border-color: #28a7ae;
  box-shadow: 0 0 6px rgba(40, 167, 174, 0.4);
}
.popup {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #4caf50;
  color: white;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 1rem;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.popup.show {
  opacity: 1;
}

.popup.hidden {
  display: none;
}
nav,
.nav-links a,
.welcome-msg,
.mobile-menu a {
  font-family: 'Fredoka', sans-serif;
}
.locked-avatar {
  position: relative;
  display: inline-block;
}

.avatar-img.locked {
  filter: grayscale(100%) brightness(80%);
  cursor: not-allowed;
}

.lock-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 18px;
  color: white;
  text-shadow: 0 0 6px rgba(0,0,0,0.6);
  pointer-events: none;
}

  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <a href="/index.html">
        <img src="images/SingerLogo.png" alt="Guess the Character Logo" loading="lazy">
      </a>
    </div>
    
  </header>
  <nav>
    <div class="welcome-nav">
      <div id="welcomeMessage" class="welcome-msg" style="cursor:pointer;"></div>
    </div>
    <div class="nav-links">
      <a href="/index.html">Home</a>
      <a href="/memory.html">Play</a>
      <a href="/memory-leaderboard.html">Leaderboard</a>
      <a href="/about.html">About</a>
    </div>
  </nav>
  <div class="profile-container">
    <div class="profile-header">
      <div class="avatar-display">
        <img src="images/avatars/popstarpenguin.jpg" id="currentAvatar" alt="Avatar" />
        <div>
          <div id="profileName" style="font-weight: 600; font-size: 18px;"></div>
          <div style="font-size: 14px; color: gray;"><i class="fas fa-map-marker-alt"></i> <span id="profileCity"></span></div>
        </div>
      </div>
      <div class="edit-icon" onclick="openEditPopup()">
        <i class="fas fa-pen"></i>
      </div>
    </div>

    <div class="status-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h4>Currently Vibing To...</h4>
          <button class="edit-btn" onclick="openVibesEditor()">Edit</button>
        </div>
        <div class="status-tags" id="vibingTags">
        </div>
      </div>

      <div id="vibesModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#00000088; justify-content:center; align-items:center;">
        <div style="background:white; padding:20px; border-radius:12px; max-width:400px; width:90%;">
          <h3>Edit Vibing Artists</h3>
          <input type="text" id="vibeSearch" placeholder="Add artist..." />
                    <div id="editableVibes" class="status-tags" style="margin-bottom:10px;"></div>
          <button class="btn" onclick="saveVibes()">Save</button>
          <button class="btn" style="background:#ccc; color:#333; margin-top:10px;" onclick="closeVibesEditor()">Close</button>
        </div>
      </div>
      
      
    <div class="dashboard-section">
      <h4>Dashboard</h4>
      <button class="btn" style="background: #ffcb05; color: #000;" onclick="showPersonalBests()">View Personal Bests</button>
      <div id="personalBestsModal" class="modal">
        <div class="modal-content">
          <h3>Personal Bests</h3>
          <p id="myScoreText">üéØ Your Personal Best: </p>
          <p id="myRankText">üèÜ Ranking: </p>
          <button class="btn" onclick="document.getElementById('personalBestsModal').classList.remove('show')">Close</button>
        </div>
      </div>

    <button class="btn" style="background: #e74c3c;" onclick="logout()">Log Out</button>
  </div>

  <div id="editPopup" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 10px;">Edit Profile</h3>
      <div class="input-group">
        <label for="editUsername">Nickname</label>
        <input type="text" id="editUsername" placeholder="Enter nickname" />
      </div>
      <div class="input-group">
        <label for="city">Select Your City</label>
        <select id="city" required>
          <option value="">--Choose a city--</option>
          
            <optgroup label="üá∫üá∏ United States">
              <option>Atlanta</option>
              <option>Austin</option>
              <option>Boise</option>
              <option>Boston</option>
              <option>Charlotte</option>
              <option>Chicago</option>
              <option>Cincinnati</option>
              <option>Dallas</option>
              <option>Denver</option>
              <option>Detroit</option>
              <option>El Paso</option>
              <option>Houston</option>
              <option>Jacksonville</option>
              <option>Kansas City</option>
              <option>Las Vegas</option>
              <option>Los Angeles</option>
              <option>Miami</option>
              <option>Minneapolis</option>
              <option>Nashville</option>
              <option>New Orleans</option>
              <option>New York</option>
              <option>Oklahoma City</option>
              <option>Orlando</option>
              <option>Philadelphia</option>
              <option>Phoenix</option>
              <option>Portland</option>
              <option>Salt Lake City</option>
              <option>San Diego</option>
              <option>San Francisco</option>
              <option>Seattle</option>
              <option>Tampa</option>
              <option>Washington, D.C.</option>
            </optgroup>
          
            <optgroup label="üåç Worldwide">
              <option>Amsterdam</option>
              <option>Auckland</option>
              <option>Bangkok</option>
              <option>Barcelona</option>
              <option>Beijing</option>
              <option>Berlin</option>
              <option>Bogot√°</option>
              <option>Brussels</option>
              <option>Buenos Aires</option>
              <option>Cape Town</option>
              <option>Copenhagen</option>
              <option>Delhi</option>
              <option>Dubai</option>
              <option>Dublin</option>
              <option>Frankfurt</option>
              <option>Hanoi</option>
              <option>Hong Kong</option>
              <option>Istanbul</option>
              <option>Jakarta</option>
              <option>Johannesburg</option>
              <option>Kyoto</option>
              <option>Lima</option>
              <option>Lisbon</option>
              <option>London</option>
              <option>Madrid</option>
              <option>Manila</option>
              <option>Melbourne</option>
              <option>Mexico City</option>
              <option>Milan</option>
              <option>Montreal</option>
              <option>Mumbai</option>
              <option>Nairobi</option>
              <option>Osaka</option>
              <option>Paris</option>
              <option>Prague</option>
              <option>Rio de Janeiro</option>
              <option>Rome</option>
              <option>Santiago</option>
              <option>S√£o Paulo</option>
              <option>Seoul</option>
              <option>Shanghai</option>
              <option>Singapore</option>
              <option>Stockholm</option>
              <option>Sydney</option>
              <option>Tokyo</option>
              <option>Toronto</option>
              <option>Vancouver</option>
              <option>Vienna</option>
              <option>Warsaw</option>
              <option>Zurich</option>
            </optgroup>
          </select>
      <div class="input-group">
        <label for="avatar">Select Your Avatar</label>
        <div class="avatar-grid">
          <img src="images/avatars/popstarpenguin.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/jazzyjaguar.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/discodolphin.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/musicalmonkey.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/souptimmy.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/vincent.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
        </div>
        
        <div class="avatar-grid">
          <img src="images/avatars/DancingDumpling.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/Sauceman.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <img src="images/avatars/MusicalMatcha.jpg" class="avatar-img" onclick="selectAvatar(this); previewAvatar(this)"
          />
          <div class="locked-avatar">
            <img src="images/avatars/ShowerSloth.jpg" class="avatar-img locked" />
            <div class="lock-icon"><i class="fas fa-lock"></i></div>
          </div>
          <div class="locked-avatar">
            <img src="images/avatars/KaraokeKoala.jpg" class="avatar-img locked" />
            <div class="lock-icon"><i class="fas fa-lock"></i></div>
          </div>
          <div class="locked-avatar">
            <img src="images/avatars/TalentShowTurtle.jpg" class="avatar-img locked" />
            <div class="lock-icon"><i class="fas fa-lock"></i></div>
          </div>
          </div>

          <div class="avatar-grid">
            <div class="locked-avatar">
              <img src="images/avatars/RisingStarfish.jpg" class="avatar-img locked" />
              <div class="lock-icon"><i class="fas fa-lock"></i></div>
            </div>
            <div class="locked-avatar">
              <img src="images/avatars/ChartToppingTiger.jpg" class="avatar-img locked" />
              <div class="lock-icon"><i class="fas fa-lock"></i></div>
            </div>
      </div>
      <button class="btn" onclick="saveProfileEdits()">Save</button>
      <button class="btn" style="background:#ccc; color:#000;" onclick="closeEditPopup()">Close</button>
    </div>
  </div>
  <div id="savePopup" class="popup hidden">
    <div class="popup-content">‚úÖ Profile saved!</div>
  </div>
  <div id="avatarPreviewModal" class="modal" style="background: rgba(0,0,0,0.7);">
    <div class="modal-content" style="background: none; box-shadow: none; padding: 0;">
      <span class="close" onclick="closeAvatarPreview()">&times;</span>
      <img id="previewAvatarImg" src="" alt="Avatar Preview" style="max-width: 200px; max-height: 200px; border-radius: 50%; border: 4px solid #fff; display: block; margin: auto;" />
    </div>
  </div>
  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyD36qSJ8YAPc3A4FL9jlBGlpiWwj530SPQ",
      authDomain: "guessthesinger10.firebaseapp.com",
      projectId: "guessthesinger10",
      storageBucket: "guessthesinger10.appspot.com",
      messagingSenderId: "97201023235",
      appId: "1:97201023235:web:ab111d9acb43ef7d4be136"
    };
  
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const firestore = getFirestore(app);
  
    document.addEventListener("DOMContentLoaded", () => {
      const profileName = document.getElementById("profileName");
      const profileCity = document.getElementById("profileCity");
      const currentAvatar = document.getElementById("currentAvatar");
      const editUsername = document.getElementById("editUsername");
      const editCity = document.getElementById("city");
      const avatarImages = document.querySelectorAll(".avatar-img");
      let selectedAvatar = "";
  
      onAuthStateChanged(auth, async user => {

        if (!user) {
          window.location.href = "login.html";
          return;
        }
  
        try {
          const docRef = doc(firestore, "users", user.uid);
          const docSnap = await getDoc(docRef);
  
          if (docSnap.exists()) {
  const data = docSnap.data();
  profileName.innerText = data.username || "";
  profileCity.innerText = data.city || "";
  currentAvatar.src = data.avatar || "";
  editUsername.value = data.username || "";
  editCity.value = data.city || "";
  selectedAvatar = data.avatar || "";

  avatarImages.forEach(i => {
  if (i.src.includes(selectedAvatar)) {
    i.classList.add("selected");
  } else {
    i.classList.remove("selected");
  }
});

  selectedArtists = data.favoriteArtist
  ? data.favoriteArtist.split(",").map(s => s.trim())
  : [];

  const tagContainer = document.getElementById("vibingTags");
  tagContainer.innerHTML = "";
  selectedArtists.forEach(artist => {
    const tag = document.createElement("div");
    tag.className = "status-tag";
    tag.innerText = artist;
    tagContainer.appendChild(tag);
  });
  
            avatarImages.forEach(img => {
              if (img.src.includes(data.avatar)) {
                img.classList.add("selected");
              } else {
                img.classList.remove("selected");
              }
            });
          }
        } catch (error) {
          console.error("Error loading profile:", error);
        }
  
        window.saveProfileEdits = async function () {
          const username = editUsername.value.trim();
          const city = editCity.value;
  
          profileName.innerText = username;
          profileCity.innerText = city;
          currentAvatar.src = selectedAvatar;
  
          try {
            await setDoc(doc(firestore, "users", user.uid), {
  uid: user.uid,
  email: user.email,
  username,
  city,
  avatar: selectedAvatar,
  favoriteArtist: selectedArtists.join(",")
});
            await updateProfile(user, { displayName: username });
            showSavePopup();
          } catch (err) {
            console.error("Error saving profile:", err);
            alert("Error saving profile: " + err.message);
          }
        };
  
        window.selectAvatar = function (img) {
          selectedAvatar = img.src;
          avatarImages.forEach(i => i.classList.remove("selected"));
          img.classList.add("selected");
        };
  
        window.openEditPopup = function () {
          document.getElementById('editPopup').style.display = 'flex';
          editUsername.value = profileName.innerText;
          editCity.value = profileCity.innerText;
        };
  
        window.closeEditPopup = function () {
          document.getElementById('editPopup').style.display = 'none';
        };
      });
    });

let selectedArtists = [];

document.getElementById("vibeSearch").addEventListener("keydown", function (e) {
  if (e.key === "Enter") {
    const val = e.target.value.trim();
    if (val && selectedArtists.length < 10 && !selectedArtists.includes(val)) {
      selectedArtists.push(val);
      e.target.value = "";
      openVibesEditor(); // re-render tags with new artist
    }
  }
});

window.openVibesEditor = function () {
  const tagContainer = document.getElementById("editableVibes");
  tagContainer.innerHTML = "";

  selectedArtists.forEach((artist, index) => {
    const tag = document.createElement("div");
    tag.className = "status-tag";
    tag.innerHTML = `${artist} <span style="cursor:pointer; margin-left:8px;" onclick="removeArtist(${index})">&times;</span>`;
    tagContainer.appendChild(tag);
  });

  document.getElementById("vibesModal").style.display = "flex";
};

window.removeArtist = function (index) {
  selectedArtists.splice(index, 1);
  openVibesEditor(); 
};window.saveVibes = async function () {
  const input = document.getElementById("vibeSearch");
  const val = input.value.trim();

  // Add input value to selectedArtists if valid
  if (val && selectedArtists.length < 10 && !selectedArtists.includes(val)) {
    selectedArtists.push(val);
    input.value = "";
  }

  // Render the tags in profile view
  const tagContainer = document.getElementById("vibingTags");
  tagContainer.innerHTML = "";
  selectedArtists.forEach(artist => {
    const tag = document.createElement("div");
    tag.className = "status-tag";
    tag.innerText = artist;
    tagContainer.appendChild(tag);
  });

  // Save to Firestore
  const user = auth.currentUser;
  if (user) {
    await setDoc(doc(firestore, "users", user.uid), {
      favoriteArtist: selectedArtists.join(",")
    }, { merge: true });
  }

  // Close modal
  window.closeVibesEditor(); 
};


window.closeVibesEditor = function () {
  document.getElementById("vibesModal").style.display = "none";
};

window.logout = function () {
  signOut(auth).then(() => {
    console.log("‚úÖ Logged out successfully");
    window.location.href = "login.html"; // redirect after logout
  }).catch((error) => {
    console.error("‚ùå Logout error:", error);
    alert("Logout failed. Please try again.");
  });
};

window.showPersonalBests = async function () {
  const user = auth.currentUser;
  if (!user) return;

  try {
    // Get current user's personal best
    const bestRef = doc(firestore, "matchBests", user.uid);
    const bestSnap = await getDoc(bestRef);
    const myScore = bestSnap.exists() ? bestSnap.data().bestScore : 0;

    // Pull all matchScores instead of matchBests
    const allScoreSnapshot = await getDocs(collection(firestore, "matchScores"));
    const allScores = [];

    allScoreSnapshot.forEach(doc => {
      const data = doc.data();
      if (data && typeof data.score === "number") {
        allScores.push(data.score);
      }
    });

    allScores.sort((a, b) => b - a);
    const myRank = allScores.indexOf(myScore) + 1;

    document.getElementById("myScoreText").innerText = `üéØ Your Personal Best: ${myScore}`;
    document.getElementById("myRankText").innerText = `üèÜ Ranking: #${myRank} of ${allScores.length}`;

    document.getElementById("personalBestsModal").classList.add("show");
  } catch (error) {
    console.error("Error fetching personal bests:", error);
  }
};


window.closePersonalBestsModal = function () {
  document.getElementById("personalBestsModal").classList.remove("show");
};
function showSavePopup() {
  const popup = document.getElementById("savePopup");
  popup.classList.remove("hidden");
  popup.classList.add("show");

  setTimeout(() => {
    popup.classList.remove("show");
    popup.classList.add("hidden");
  }, 3000);
}
window.selectAvatar = function (img) {
  if (img.classList.contains("locked")) {
    alert("This avatar is locked! Earn it by leveling up üéâ");
    return;
  }
  selectedAvatar = img.src;
  document.querySelectorAll(".avatar-img").forEach(i => i.classList.remove("selected"));
  img.classList.add("selected");
};
window.previewAvatar = function (img) {
  if (img.classList.contains("locked")) return; // skip locked avatars
  const modal = document.getElementById("avatarPreviewModal");
  const previewImg = document.getElementById("previewAvatarImg");
  previewImg.src = img.src;
  modal.classList.add("show");
};

window.closeAvatarPreview = function () {
  document.getElementById("avatarPreviewModal").classList.remove("show");
};

  </script>
  
</body>
</html>
