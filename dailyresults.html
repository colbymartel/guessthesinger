<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Game Results - Guess The Singer</title>
  <link rel="icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Fredoka', sans-serif;
      background: linear-gradient(to bottom, #ffffff, #e7f1f9);
      min-height: 100vh;
      color: #234d7d;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #3b7bbf, #234d7d);
      padding: 30px 20px;
      text-align: center;
      color: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .header h1 {
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
    }

    .header .subtitle {
      margin-top: 10px;
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Navigation */
    nav {
      background-color: #1e2b38;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .welcome-msg {
      font-weight: bold;
      color: #ffcb05;
      cursor: pointer;
    }

    .welcome-msg:hover {
      text-decoration: underline;
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 40px;
      margin-right: 30px;
      background-color: #1e2b38;
      padding: 10px;
      border-radius: 10px;
      flex-direction: column;
      min-width: 150px;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .dropdown.show {
      display: flex;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .dropdown a {
      color: white;
      text-decoration: none;
      padding: 8px 12px;
      font-weight: bold;
    }

    .dropdown a:hover {
      background-color: #ffcb05;
      color: #1e2b38;
    }

    .coin-emoji {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #ffd700, #f1c40f);
      border-radius: 50%;
      box-shadow: 0 4px 8px rgba(241, 196, 15, 0.3);
      position: relative;
      display: inline-block;
      animation: coinGlow 2s ease-in-out infinite alternate;
    }

    @keyframes coinGlow {
      from { box-shadow: 0 4px 8px rgba(241, 196, 15, 0.3); }
      to { box-shadow: 0 4px 16px rgba(241, 196, 15, 0.6); }
    }

    #coinCount {
      font-weight: 600;
      color: white;
      font-size: 1.1rem;
    }

    /* Main Content */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* Date Selector */
    .date-selector {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
    }

    .date-selector h2 {
      margin: 0 0 20px 0;
      color: #234d7d;
      font-size: 1.5rem;
    }

    .date-input {
      padding: 12px 20px;
      border: 2px solid #3b7bbf;
      border-radius: 10px;
      font-size: 1.1rem;
      font-family: 'Fredoka', sans-serif;
      color: #234d7d;
      background: white;
      cursor: pointer;
    }

    .date-input:focus {
      outline: none;
      border-color: #ffcb05;
      box-shadow: 0 0 0 3px rgba(255, 203, 5, 0.1);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      border-color: #3b7bbf;
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: #3b7bbf;
      margin-bottom: 10px;
    }

    .stat-label {
      font-size: 1.1rem;
      color: #666;
      font-weight: 500;
    }

    /* Results Table */
    .results-container {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .results-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #234d7d;
      margin: 0;
    }

    .export-btn {
      background: linear-gradient(135deg, #3b7bbf, #234d7d);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(59, 123, 191, 0.3);
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .results-table th {
      background: linear-gradient(135deg, #3b7bbf, #234d7d);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      border-radius: 8px 8px 0 0;
    }

    .results-table td {
      padding: 15px;
      border-bottom: 1px solid #eee;
      color: #234d7d;
    }

    .results-table tr:hover {
      background-color: #f8f9fa;
    }

    .results-table tr:last-child td {
      border-bottom: none;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 50px;
      color: #666;
    }

    .loading i {
      font-size: 2rem;
      color: #3b7bbf;
      margin-bottom: 15px;
    }

    /* No Results */
    .no-results {
      text-align: center;
      padding: 50px;
      color: #666;
    }

    .no-results i {
      font-size: 3rem;
      color: #ccc;
      margin-bottom: 15px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #1e2b38;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 12px 0;
      z-index: 999;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }

    .bottom-nav .nav-item {
      color: white;
      text-align: center;
      text-decoration: none;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .bottom-nav .nav-item i,
    .bottom-nav .nav-item img {
      display: block;
      font-size: 22px;
      width: 26px;
      height: 26px;
      object-fit: contain;
      transition: all 0.3s ease;
    }

    .bottom-nav .nav-item:hover {
      color: #ffcb05;
      background: rgba(255, 203, 5, 0.1);
      transform: translateY(-2px);
    }

    .bottom-nav .nav-item.highlight {
      color: #ffcb05;
      background: rgba(255, 203, 5, 0.1);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-container {
        padding: 20px 15px;
      }

      .header h1 {
        font-size: 1.8rem;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .stat-card {
        padding: 20px;
      }

      .stat-number {
        font-size: 2rem;
      }

      .results-container {
        padding: 20px;
      }

      .results-header {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }

      .results-table {
        font-size: 0.9rem;
      }

      .results-table th,
      .results-table td {
        padding: 10px 8px;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 1.6rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .results-table {
        font-size: 0.8rem;
      }

      .results-table th,
      .results-table td {
        padding: 8px 6px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>ðŸ“Š Daily Game Results</h1>
    <div class="subtitle">Track player performance and statistics</div>
  </header>

  <nav style="display: flex; align-items: center; justify-content: space-between; background: #1e2b38; min-height: 48px;">
    <div style="display: flex; align-items: center; gap: 20px;">
      <div class="welcome-nav" style="position: relative;">
        <div id="welcomeMessage" class="welcome-msg" onclick="toggleDropdown()">Welcome</div>
        <div id="dropdownMenu" class="dropdown"></div>
      </div>
      <div id="coinWrapper" style="display: flex; align-items: center; gap: 6px;">
        <div class="coin-emoji"></div>
        <span id="coinCount">0</span>
        <span id="coinGain" class="coin-gain hidden">+1</span>
      </div>
    </div>
    <div class="hamburger" id="hamburger">
      <i class="fas fa-bars"></i>
    </div>
  </nav>

  <div class="main-container">
    <div class="date-selector">
      <h2>Select Date</h2>
      <input type="date" id="dateSelector" class="date-input" onchange="loadResults()">
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalPlayers">0</div>
        <div class="stat-label">Total Players</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="avgGuesses">0</div>
        <div class="stat-label">Avg Guesses</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="avgHints">0</div>
        <div class="stat-label">Avg Hints</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="perfectScores">0</div>
        <div class="stat-label">Perfect Scores</div>
      </div>
    </div>

    <div class="results-container">
      <div class="results-header">
        <h3 class="results-title">Player Results</h3>
        <button class="export-btn" onclick="exportResults()">
          <i class="fas fa-download"></i> Export CSV
        </button>
      </div>
      
      <div id="resultsContent">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <div>Loading results...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <a href="/profile.html" class="nav-item">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </a>
    <a href="/games.html" class="nav-item">
      <img src="/images/gamesicon.png" alt="Games Icon" style="width: 26px; height: 26px;">
      <span>Games</span>
    </a>
    <a href="/memory-leaderboard.html" class="nav-item">
      <i class="fas fa-trophy"></i>
      <span>Leaderboards</span>
    </a>
    <a href="/rewards.html" class="nav-item">
      <img src="/images/rewardicon.png" alt="Rewards Icon" style="width: 26px; height: 26px;">
      <span>Rewards</span>
    </a>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
    import { getFirestore, collection, query, where, getDocs, orderBy, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyD36qSJ8YAPc3A4FL9jlBGlpiWwj530SPQ",
      authDomain: "guessthesinger10.firebaseapp.com",
      projectId: "guessthesinger10",
      storageBucket: "guessthesinger10.appspot.com",
      messagingSenderId: "97201023235",
      appId: "1:97201023235:web:ab111d9acb43ef7d4be136"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser = null;
    let userCoins = 0;

    onAuthStateChanged(auth, async user => {
      currentUser = user;
      if (user) {
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);
        if (userSnap.exists()) {
          const data = userSnap.data();
          const username = data.username || user.displayName || "User";
          userCoins = data.coins || 0;
          document.getElementById("welcomeMessage").textContent = `Welcome, ${username}`;
          document.getElementById("coinCount").textContent = userCoins;
          
          document.getElementById("dropdownMenu").innerHTML = `
            <a href="/profile.html">Edit Profile</a>
            <a href="#" id="logoutBtn">Log Out</a>
          `;
          
          setTimeout(() => {
            const logoutBtn = document.getElementById("logoutBtn");
            if (logoutBtn) {
              logoutBtn.addEventListener("click", async (e) => {
                e.preventDefault();
                try {
                  await signOut(auth);
                  window.location.reload();
                } catch (err) {
                  console.error("Logout failed:", err);
                }
              });
            }
          }, 0);
        }
      } else {
        document.getElementById("welcomeMessage").textContent = "Welcome, Anonymous";
        document.getElementById("coinCount").textContent = "0";
        
        document.getElementById("dropdownMenu").innerHTML = `
          <a href="/signup.html">Create Profile</a>
          <a href="/login.html">Log In</a>
        `;
      }
    });

    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('dateSelector').value = today;

    // Load results for the selected date
    window.loadResults = async function() {
      const selectedDate = document.getElementById('dateSelector').value;
      const resultsContent = document.getElementById('resultsContent');
      
      resultsContent.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <div>Loading results for ${selectedDate}...</div>
        </div>
      `;

      try {
        // Query for daily game completions on the selected date
        const startOfDay = new Date(selectedDate + 'T00:00:00');
        const endOfDay = new Date(selectedDate + 'T23:59:59');
        
        const completionsRef = collection(db, "dailyGameCompletions");
        const q = query(
          completionsRef,
          where("completionDate", ">=", startOfDay),
          where("completionDate", "<=", endOfDay),
          orderBy("completionDate", "desc")
        );
        
        const querySnapshot = await getDocs(q);
        const results = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          results.push({
            name: data.username || data.displayName || "Anonymous",
            email: data.email || "No email",
            guessCount: data.totalGuesses || 0,
            hintCount: data.hintsUsed || 0,
            score: data.score || 0,
            completionTime: data.completionDate?.toDate() || new Date()
          });
        });

        displayResults(results);
        updateStats(results);
        
      } catch (error) {
        console.error("Error loading results:", error);
        resultsContent.innerHTML = `
          <div class="no-results">
            <i class="fas fa-exclamation-triangle"></i>
            <div>Error loading results. Please try again.</div>
          </div>
        `;
      }
    };

    function displayResults(results) {
      const resultsContent = document.getElementById('resultsContent');
      
      if (results.length === 0) {
        resultsContent.innerHTML = `
          <div class="no-results">
            <i class="fas fa-calendar-times"></i>
            <div>No results found for this date.</div>
          </div>
        `;
        return;
      }

      const tableHTML = `
        <table class="results-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Guesses</th>
              <th>Hints</th>
              <th>Score</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            ${results.map(result => `
              <tr>
                <td>${result.name}</td>
                <td>${result.email}</td>
                <td>${result.guessCount}</td>
                <td>${result.hintCount}</td>
                <td>${result.score}/100</td>
                <td>${result.completionTime.toLocaleTimeString()}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      resultsContent.innerHTML = tableHTML;
    }

    function updateStats(results) {
      if (results.length === 0) {
        document.getElementById('totalPlayers').textContent = '0';
        document.getElementById('avgGuesses').textContent = '0';
        document.getElementById('avgHints').textContent = '0';
        document.getElementById('perfectScores').textContent = '0';
        return;
      }

      const totalPlayers = results.length;
      const avgGuesses = Math.round(results.reduce((sum, r) => sum + r.guessCount, 0) / totalPlayers);
      const avgHints = Math.round(results.reduce((sum, r) => sum + r.hintCount, 0) / totalPlayers);
      const perfectScores = results.filter(r => r.score === 100).length;

      document.getElementById('totalPlayers').textContent = totalPlayers;
      document.getElementById('avgGuesses').textContent = avgGuesses;
      document.getElementById('avgHints').textContent = avgHints;
      document.getElementById('perfectScores').textContent = perfectScores;
    }

    window.exportResults = function() {
      const selectedDate = document.getElementById('dateSelector').value;
      const table = document.querySelector('.results-table');
      
      if (!table) {
        alert('No data to export');
        return;
      }

      let csv = 'Name,Email,Guesses,Hints,Score,Time\n';
      const rows = table.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = Array.from(cells).map(cell => `"${cell.textContent}"`).join(',');
        csv += rowData + '\n';
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `daily-results-${selectedDate}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    };

    // Dropdown menu functionality
    window.toggleDropdown = function() {
      const dropdown = document.getElementById('dropdownMenu');
      dropdown.classList.toggle('show');
    };
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('dropdownMenu');
      const welcomeMsg = document.getElementById('welcomeMessage');
      if (dropdown && !dropdown.contains(event.target) && !welcomeMsg.contains(event.target)) {
        dropdown.classList.remove('show');
      }
    });

    // Load initial results
    loadResults();
  </script>
</body>
</html> 